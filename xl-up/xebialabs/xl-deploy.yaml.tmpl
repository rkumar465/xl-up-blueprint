apiVersion: xl-deploy/v1
kind: Applications
spec:
  - directory: Applications/XEBIALABS
    children:
      - directory: XL-DEPLOY
        children:
          {{if (or (eq .K8sSetup "AWS EKS" ) ( eq .K8sSetup "Plain multinode K8s cluster" ))}}
          - name: XL-Deploy-Deployment
            type: udm.Application
            children:
              - name: "{{.xlVersion}}"
                type: udm.DeploymentPackage
                orchestrator:
                  - sequential-by-dependency
                deployables:
                  - name: xld-deployment
                    type: k8s.ResourcesFile
                    file: !file kubernetes/xl-deploy/external-db/hot-standby/xld-deployment-hot-standby.yaml
                  - name: xld-pvc
                    type: k8s.ResourcesFile
                    file: !file kubernetes/xl-deploy/external-db/hot-standby/pvc.yaml
                  {{- if eq .K8sSetup "AWS EKS" }}
                  - name: aws-efs-conf
                    type: k8s.ResourcesFile
                    file: !file kubernetes/xl-deploy/external-db/hot-standby/aws-efs/aws-efs-conf.yaml
                  - name: aws-efs-deployment
                    type: k8s.ResourcesFile
                    file: !file kubernetes/xl-deploy/external-db/hot-standby/aws-efs/aws-efs-deployment.yaml
                  - name: aws-efs-rbac
                    type: k8s.ResourcesFile
                    file: !file kubernetes/xl-deploy/external-db/hot-standby/aws-efs/aws-efs-rbac.yaml
                  {{ end }}
                applicationDependencies: null
                undeployDependencies: "true"
          {{end}}
          {{if  eq .K8sSetup "Local K8s from Docker Desktop for Mac/Windows" }}
          - name: XL-Deploy-Deployment
            type: udm.Application
            children:
              - name: "{{.xlVersion}}"
                orchestrator:
                  - sequential-by-dependency
                type: udm.DeploymentPackage
                deployables:
                  - name: xld-deployment
                    type: k8s.ResourcesFile
                    file: !file kubernetes/xl-deploy/local-db/xld-deployment-single-node.yaml
                applicationDependencies: null
                undeployDependencies: "true"
          {{end}}